<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>just stream anime - Trending Now</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-pacifico { font-family: 'Pacifico', serif; }
    .anime-card:hover { transform: translateY(-8px) scale(1.04); box-shadow: 0 12px 36px rgba(0,0,0,0.50); }
    .anime-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 2rem; }
    ::selection { background: #6366f1; color: #fff; }
    #pagination button.active { background: #6366f1; color: #fff; border-radius: 0.375rem;}
    #pagination button { transition: background 0.2s, color 0.2s;}
    .custom-gradient { background: linear-gradient(90deg, #6366f1 0%, #3b82f6 100%); }
    .anime-card { transition: box-shadow 0.2s, transform 0.2s; }
    .modal-bg { background: rgba(0,0,0,0.92); }
    .hero-image {
      width: 100vw;
      height: 60vh;
      object-fit: cover;
      filter: brightness(0.9) blur(0px);
      transition: transform 0.5s, filter 0.5s;
      transform: scale(1.08);
      background: #222;
      box-shadow: 0 12px 36px rgba(0,0,0,0.5);
    }
    .hero-controls {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100vw;
      transform: translateY(-50%);
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .hero-button {
      background: rgba(30,41,59,0.7);
      color: #fff;
      font-size: 2.5rem;
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      pointer-events: all;
      border: 2px solid #6366f1;
      transition: background 0.2s;
    }
    .hero-button:hover {
      background: rgba(99,102,241,0.8);
    }
    @media(max-width: 768px) {
      .hero-image { height: 36vh; }
      .hero-controls { width: 100vw; }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-black to-gray-800 text-white min-h-screen">

  <!-- Header -->
  <header class="custom-gradient backdrop-blur border-b border-gray-800 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 flex items-center justify-between h-16">
      <h1 class="text-3xl font-bold font-pacifico text-white drop-shadow">just stream anime</h1>
      <div class="relative">
        <input type="text" id="searchInput" placeholder="Search anime..." oninput="searchAnime()" class="bg-gray-800 text-white pl-10 pr-4 py-2 rounded-lg border border-gray-700 w-64 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        <div id="searchDropdown" class="absolute top-full left-0 right-0 mt-1 bg-gray-800 rounded-lg shadow-lg border border-gray-700 hidden z-50">
          <div id="searchResults"></div>
          <div id="noSearchResults" class="p-4 text-center text-gray-400 hidden">No anime found</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="bg-black relative" style="overflow: hidden;">
    <div style="position:relative; width:100vw; height:60vh;">
      <img id="heroImage" class="hero-image" alt="Hero Anime" />
      <div class="hero-controls">
        <button class="hero-button" id="heroPrev" aria-label="Previous Anime"><i class="ri-arrow-left-s-line"></i></button>
        <button class="hero-button" id="heroNext" aria-label="Next Anime"><i class="ri-arrow-right-s-line"></i></button>
      </div>
      <div id="heroTitle" style="position:absolute;bottom:2rem;left:2rem;max-width:60vw;background:rgba(30,41,59,0.75);padding:1rem 1.5rem;border-radius:1rem;font-size:2rem;font-weight:bold;color:#fff;box-shadow:0 4px 20px #000;">
        <!-- Title goes here -->
      </div>
    </div>
    <div class="flex justify-center space-x-4 py-6">
      <a id="heroLink" href="#" target="_blank" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-2 rounded-lg font-semibold">Watch Now</a>
      <button onclick="showAnimeDetail(currentHeroId)" class="bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg font-semibold">More Info</button>
    </div>
  </section>

  <!-- Anime Grid -->
  <main class="max-w-7xl mx-auto px-4 py-12">
    <h2 id="mainTitle" class="text-3xl font-bold mb-6 text-indigo-400">Trending Anime</h2>
    <div id="animeGrid" class="anime-grid"></div>
    <div id="pagination" class="flex justify-center items-center gap-2 mt-8"></div>
  </main>

  <!-- Modal -->
  <div id="animeModal" class="fixed inset-0 modal-bg z-50 hidden overflow-y-auto">
    <div class="min-h-screen p-4">
      <div class="max-w-4xl mx-auto bg-gray-900 rounded-lg overflow-hidden relative">
        <button onclick="closeModal()" class="absolute top-4 right-4 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75">
          <i class="ri-close-line"></i>
        </button>
        <div id="modalContent"></div>
      </div>
    </div>
  </div>

  <script>
    // Globals
    let animeData = [];
    let currentPage = 1;
    const pageSize = 50; // AniList max per page is 50
    let currentHeroIndex = 0;
    let currentHeroId = null;
    let totalPages = 1;
    let heroInterval = null;

    // AniList GraphQL query for trending anime
    const trendingQuery = `
      query ($page: Int, $perPage: Int) {
        Page(page: $page, perPage: $perPage) {
          pageInfo { total, currentPage, lastPage, hasNextPage, perPage }
          media(type: ANIME, sort: TRENDING_DESC) {
            id
            title { romaji english native }
            coverImage { large color }
            description(asHtml: false)
            averageScore
            episodes
            seasonYear
            siteUrl
          }
        }
      }
    `;
    async function fetchTrendingAnime(page = 1) {
      const res = await fetch('https://graphql.anilist.co', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: trendingQuery, variables: { page, perPage: pageSize } })
      });
      const data = await res.json();
      if (!data.data || !data.data.Page || !data.data.Page.media) return [];
      totalPages = data.data.Page.pageInfo.lastPage || 1;
      return data.data.Page.media.map(a => ({
        id: a.id,
        title: a.title.english || a.title.romaji || a.title.native,
        image: a.coverImage.large,
        description: a.description,
        rating: a.averageScore,
        year: a.seasonYear,
        episodes: a.episodes,
        link: a.siteUrl
      }));
    }

    // Hero Section
    function updateHero(idx = 0) {
      if (animeData.length === 0) return;
      currentHeroIndex = idx;
      const anime = animeData[idx];
      currentHeroId = anime.id;
      document.getElementById("heroImage").src = anime.image;
      document.getElementById("heroLink").href = anime.link;
      document.getElementById("heroTitle").textContent = anime.title;
    }

    function showNextHero() {
      if (animeData.length === 0) return;
      currentHeroIndex = (currentHeroIndex + 1) % animeData.length;
      updateHero(currentHeroIndex);
    }

    function showPrevHero() {
      if (animeData.length === 0) return;
      currentHeroIndex = (currentHeroIndex - 1 + animeData.length) % animeData.length;
      updateHero(currentHeroIndex);
    }

    function startHeroAutoChange() {
      if (heroInterval) clearInterval(heroInterval);
      heroInterval = setInterval(() => {
        showNextHero();
      }, 10000); // 10 seconds
    }

    // Anime Grid
    function renderAnimeGrid() {
      const grid = document.getElementById("animeGrid");
      grid.innerHTML = animeData.map(anime => `
        <div class="anime-card bg-gray-900 rounded-lg overflow-hidden shadow-lg cursor-pointer relative group" onclick="showAnimeDetail('${anime.id}')">
          <img src="${anime.image}" alt="${anime.title}" class="w-full h-56 object-cover" onerror="this.style.display='none'">
          <div class="p-4">
            <h3 class="text-lg font-semibold text-white mb-1">${anime.title}</h3>
            <div class="mt-2 flex items-center text-sm text-gray-300 space-x-2">
              <i class="ri-star-fill text-yellow-400"></i><span>${anime.rating || "?"}</span>
              <span>•</span><span>${anime.year || ""}</span>
              <span>•</span><span>${anime.episodes || "?"} eps</span>
            </div>
          </div>
        </div>
      `).join("");
    }

    // Pagination Controls
    function renderPagination() {
      const pagDiv = document.getElementById("pagination");
      let buttons = '';
      let start = Math.max(1, currentPage - 2);
      let end = Math.min(totalPages, start + 4);
      for (let i = start; i <= end; i++) {
        buttons += `<button class="px-3 py-1 bg-gray-700 text-white font-semibold${i === currentPage ? ' active' : ''}" onclick="changePage(${i})">${i}</button>`;
      }
      pagDiv.innerHTML = buttons;
    }
    async function changePage(page) {
      currentPage = page;
      animeData = await fetchTrendingAnime(page);
      currentHeroIndex = 0;
      updateHero(currentHeroIndex);
      renderAnimeGrid();
      renderPagination();
      startHeroAutoChange();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // Modal
    function showAnimeDetail(id) {
      let anime = animeData.find(a => a.id == id);
      if (!anime) return;
      const modal = document.getElementById("animeModal");
      const content = document.getElementById("modalContent");
      content.innerHTML = `
        <div class="grid md:grid-cols-2 gap-6 p-6">
          <img src="${anime.image}" alt="${anime.title}" class="w-full h-auto rounded-lg shadow-md" onerror="this.style.display='none'">
          <div>
            <h2 class="text-3xl font-bold text-white mb-4">${anime.title}</h2>
            <p class="text-gray-300 mb-4">${anime.description || "No description available."}</p>
            <div class="flex items-center space-x-4 text-sm text-gray-400 mb-6">
              <span><i class="ri-star-fill text-yellow-400"></i> ${anime.rating || "?"}</span>
              <span>•</span><span>${anime.year || ""}</span>
              <span>•</span><span>${anime.episodes || "?"} Episodes</span>
            </div>
            <a href="${anime.link}" target="_blank" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold inline-block">
              View on AniList
            </a>
          </div>
        </div>
      `;
      modal.classList.remove("hidden");
    }
    function closeModal() {
      document.getElementById("animeModal").classList.add("hidden");
    }

    // Search
    async function searchAnime() {
      const input = document.getElementById("searchInput").value.toLowerCase().trim();
      const resultsContainer = document.getElementById("searchResults");
      const dropdown = document.getElementById("searchDropdown");
      const noResults = document.getElementById("noSearchResults");
      if (!input) {
        dropdown.classList.add("hidden");
        return;
      }
      // AniList search query
      const searchQuery = `
        query ($search: String) {
          Page(perPage: 10) {
            media(search: $search, type: ANIME) {
              id
              title { romaji english native }
              coverImage { large }
              episodes
              seasonYear
              siteUrl
            }
          }
        }
      `;
      const res = await fetch('https://graphql.anilist.co', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: searchQuery, variables: { search: input } })
      });
      const data = await res.json();
      const results = data.data?.Page?.media || [];
      if (results.length === 0) {
        resultsContainer.innerHTML = "";
        noResults.classList.remove("hidden");
      } else {
        noResults.classList.add("hidden");
        resultsContainer.innerHTML = results.map(anime => `
          <div class="p-3 hover:bg-gray-700 cursor-pointer flex items-center" onclick="showAnimeDetail('${anime.id}'); dropdown.classList.add('hidden');">
            <img src="${anime.coverImage.large}" alt="${anime.title.english || anime.title.romaji}" class="w-12 h-12 object-cover rounded mr-3" onerror="this.style.display='none'">
            <div>
              <h4 class="text-white font-semibold">${anime.title.english || anime.title.romaji || anime.title.native}</h4>
              <p class="text-sm text-gray-400">${anime.seasonYear || ""} • ${anime.episodes || "?"} eps</p>
            </div>
          </div>
        `).join("");
      }
      dropdown.classList.remove("hidden");
    }

    // Init
    async function initAnime() {
      animeData = await fetchTrendingAnime(currentPage);
      currentHeroIndex = 0;
      updateHero(currentHeroIndex);
      renderAnimeGrid();
      renderPagination();
      startHeroAutoChange();
    }
    window.onload = initAnime;

    document.addEventListener('keydown', function(e){
      if(e.key === "Escape") closeModal();
    });
    document.addEventListener('click', function(e){
      if(e.target.id === "animeModal") closeModal();
    });

    // Hero navigation buttons
    document.getElementById("heroNext").onclick = function() {
      showNextHero();
      startHeroAutoChange(); // restart auto-scroll
    };
    document.getElementById("heroPrev").onclick = function() {
      showPrevHero();
      startHeroAutoChange(); // restart auto-scroll
    };
  </script>
</body>
</html>
